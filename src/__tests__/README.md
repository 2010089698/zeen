# テスト実行方法

## セットアップ

```bash
npm install
```

## テスト実行

```bash
# 全テスト実行
npm test

# ウォッチモードでテスト実行
npm run test:watch

# 特定のテストファイルのみ実行
npm test syncService.test.ts
```

## テスト内容

### syncService.test.ts

`syncService.ts`の主要フローをテストします：

1. **成功レスポンスで対象idが synced: true になる**
   - 正常なレスポンスで全てのセッションが同期される
   - savedとskippedの両方が成功として扱われる
   - 空のレコード配列の場合は何もしない

2. **500系HTTPで再試行キューに残す**
   - 500、502、429エラーで全てのセッションが再試行対象になる
   - リトライ機能が動作する（3回まで再試行）

3. **400系でもペイロードが悪い場合はエラーログだけ出して破棄**
   - 現在の実装では400系エラーも再試行対象になっている
   - 仕様に合わせるかコメントで指針を明記

4. **その他のテストケース**
   - ネットワークエラーとオフライン状態
   - バッチ処理（BATCH_SIZEを超えるレコードの分割）
   - モックモード（ENABLE_REAL_SYNC=false）
   - エラーレスポンスの詳細処理

## モック

- `fetch`: グローバルモック
- `AsyncStorage`: React Native用のストレージモック
- `getAnonId`: 匿名ID取得関数のモック
